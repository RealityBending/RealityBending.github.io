<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: February 5, 2026 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.e4b9d3e8ce28da563d74b4089f677743.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.3ff435a51cdd8004dde58fc9a0e580a7.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  






<script async src="https://www.googletagmanager.com/gtag/js?id=G-6PL469S5F7"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-6PL469S5F7', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>
























  
  
  






  <meta name="author" content="Dominique Makowski" />





  

<meta name="description" content="Understand the steps involving in setting up event triggers for your JsPsych experiments, including creating the bridge to Lab Streaming Layer, ensuring synchronisation with other signals and highly accurate timestamps." />



<link rel="alternate" hreflang="en-us" href="https://realitybending.github.io/post/2026-01-09-eventtriggers/" />
<link rel="canonical" href="https://realitybending.github.io/post/2026-01-09-eventtriggers/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu_2dd72e013364ed1a.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu_61d9f0a061d5ccd5.png" />

<meta name="theme-color" content="#9C27B0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@Dom_Makowski" />
  <meta property="twitter:creator" content="@Dom_Makowski" />
<meta property="twitter:image" content="https://realitybending.github.io/post/2026-01-09-eventtriggers/featured.png" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="Reality Bending Lab" />
<meta property="og:url" content="https://realitybending.github.io/post/2026-01-09-eventtriggers/" />
<meta property="og:title" content="How to send event triggers to Lab Streaming Layer from JsPsych | Reality Bending Lab" />
<meta property="og:description" content="Understand the steps involving in setting up event triggers for your JsPsych experiments, including creating the bridge to Lab Streaming Layer, ensuring synchronisation with other signals and highly accurate timestamps." /><meta property="og:image" content="https://realitybending.github.io/post/2026-01-09-eventtriggers/featured.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2026-01-11T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2026-01-11T00:00:00&#43;00:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://realitybending.github.io/post/2026-01-09-eventtriggers/"
  },
  "headline": "How to send event triggers to Lab Streaming Layer from JsPsych",
  
  "image": [
    "https://realitybending.github.io/post/2026-01-09-eventtriggers/featured.png"
  ],
  
  "datePublished": "2026-01-11T00:00:00Z",
  "dateModified": "2026-01-11T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "RÃ³isÃ­n Sharma"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Reality Bending Lab",
    "logo": {
      "@type": "ImageObject",
      "url": "https://realitybending.github.io/media/icon_hu_d1f1c7efb43b1959.png"
    }
  },
  "description": "Understand the steps involving in setting up event triggers for your JsPsych experiments, including creating the bridge to Lab Streaming Layer, ensuring synchronisation with other signals and highly accurate timestamps."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>How to send event triggers to Lab Streaming Layer from JsPsych | Reality Bending Lab</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="cbe8357d2bca0ef5958a7ac838d32347" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.4d86d96dd75d4de5d4f64fa2bd71da1c.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Reality Bending Lab</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Reality Bending Lab</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/people/"><span>People</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/research/"><span>Research</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/post/"><span>Blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/publication/"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/research#participate"><span>Participate</span></a>
          </li>

          
          

          
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Join us</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/jobs/postdoc/"><span>Postdoc</span></a>
              
                <a class="dropdown-item" href="/jobs/phd/"><span>PhD</span></a>
              
                <a class="dropdown-item" href="/jobs/assistant/"><span>Research Assistant</span></a>
              
                <a class="dropdown-item" href="/jobs/intern/"><span>Internship</span></a>
              
                <a class="dropdown-item" href="/jobs/projects/"><span>Research Projects</span></a>
              
            </div>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#11_contact"><span>Contact</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://github.com/RealityBending" target="_blank" rel="noopener"><span><i class="fab fa-github"; font-size: 1rem; line-height: 1.25"></i></span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  






















  
  



<div class="article-container pt-3">
  <h1>How to send event triggers to Lab Streaming Layer from JsPsych</h1>

  
  <p class="page-subtitle">Understand the steps involving in setting up event triggers for your JsPsych experiments, including creating the bridge to Lab Streaming Layer, ensuring synchronisation with other signals and highly accurate timestamps.</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    


  <span >
      <a href="/authors/roisin-sharma/">RÃ³isÃ­n Sharma</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jan 11, 2026
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    9 min read
  </span>
  

  
  
  
  

  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/reality-bending-lab/">Reality Bending Lab</a>, <a href="/category/university-of-sussex/">University of Sussex</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 500px; max-height: 497px;">
  <div style="position: relative">
    <img src="/post/2026-01-09-eventtriggers/featured_hu_7bff9185cf52640.webp" width="500" height="497" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Hello there! ðŸ‘‹ Let&rsquo;s learn how to send event triggers to Lab Streaming Layer (LSL) from JsPsych.</p>
<p>Lets start with some basics!</p>
<h2 id="what-does-this-mean-and-when-is-this-useful">What does this mean and when is this useful?</h2>
<p>Lab streaming layer (LSL) is a system used to receive, synchronise and stream signals from multiple inputs during experiments. LSL is designed to help researchers easily compare their data across multiple technologies, as time synchrony is integral for making meaningful analyses.</p>
<p>When collecting data on stimulus response during experiments, it&rsquo;s important that the stimulus onset is recorded precisely, especially if this is mapped onto physiological responses as this has implications on how we interpret our data. One good example of a use case is that you have a Muse headband or any other device that can scream via LSL, and you want to precisely mark events in it.</p>
<p>Event triggers are coded into JsPsych online experiments to accurately mark events, such as when a stimulus appeared on the screen. We have found this method to yield the most precise timestamps of events, compared to alternative methods such as using the Bitalino LUX.</p>
<p>This tutorial will explain how to set this up for an experiment situated on GitHub, although you can adapt this for your hosting platform.</p>
<p>This blog will help you understand the set-up for event triggers. For an example of this in action, refer to <a href="https://github.com/OliverACollins/muse-athena-test/tree/main/blackwhite" target="_blank" rel="noopener">https://github.com/OliverACollins/muse-athena-test/tree/main/blackwhite</a>. This experiment recorded markers on a screen turning from white to black- you may want to follow along with lsl_bridge.py and blackwhite_jspsych.html<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> for the full implementation.</p>
<h2 id="how-to-set-up-event-triggers">How to set up event triggers</h2>
<h3 id="requirements">Requirements</h3>
<ul>
<li>
<p><strong>Your experiment is in-person:</strong> In order to use these event triggers, you will need to run your experiment on a local host server, which will need to be manually set up for each trial. Therefore, this setup is intended for in-person experiments that are led by a researcher to set up the participant&rsquo;s screen.</p>
</li>
<li>
<p><strong>You have two machines, one for the participant, and one for the researcher:</strong> The participant&rsquo;s machine will display the experiment and send the markers to the researcher&rsquo;s machine, which will record the LSL stream events.</p>
</li>
<li>
<p><strong>All machines must be on the same network connection:</strong> To send the markers from the participant&rsquo;s machine to the researcher&rsquo;s recording machine, we must run the experiment on a web server which directs the markers to the recording machine via its ipv4 address.</p>
</li>
</ul>
<h3 id="the-lsl-bridge-script">The LSL bridge script</h3>
<p>The LSL bridge Python script is responsible for actually sending the markers to LSL- it &rsquo;listens&rsquo; for messages from the browser that the participant is doing the experiment from, and converts them into &lsquo;markers&rsquo; for your recording software (such as LabRecorder) to receive.</p>
<details>
<summary>See an example of a full script</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">BaseHTTPRequestHandler</span><span class="p">,</span> <span class="n">HTTPServer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">parse_qs</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">mne_lsl.lsl</span> <span class="kn">import</span> <span class="n">StreamInfo</span><span class="p">,</span> <span class="n">StreamOutlet</span><span class="p">,</span> <span class="n">local_clock</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CONFIG</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">LSL_STREAM_NAME</span> <span class="o">=</span> <span class="s2">&#34;jsPsychMarkers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">LSL_STREAM_TYPE</span> <span class="o">=</span> <span class="s2">&#34;Markers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">LSL_SOURCE_ID</span> <span class="o">=</span> <span class="s2">&#34;jspsych-lsl-bridge&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SERVER_HOST</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SERVER_PORT</span> <span class="o">=</span> <span class="mi">5000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create an LSL outlet for event markers</span>
</span></span><span class="line"><span class="cl"><span class="n">info</span> <span class="o">=</span> <span class="n">StreamInfo</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="n">LSL_STREAM_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">stype</span><span class="o">=</span><span class="n">LSL_STREAM_TYPE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">sfreq</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">dtype</span><span class="o">=</span><span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">source_id</span><span class="o">=</span><span class="n">LSL_SOURCE_ID</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">desc</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">desc</span>
</span></span><span class="line"><span class="cl"><span class="n">desc</span><span class="o">.</span><span class="n">append_child_value</span><span class="p">(</span><span class="s2">&#34;manufacturer&#34;</span><span class="p">,</span> <span class="s2">&#34;jsPsych&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">channels</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">append_child</span><span class="p">(</span><span class="s2">&#34;channels&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ch</span> <span class="o">=</span> <span class="n">channels</span><span class="o">.</span><span class="n">append_child</span><span class="p">(</span><span class="s2">&#34;channel&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ch</span><span class="o">.</span><span class="n">append_child_value</span><span class="p">(</span><span class="s2">&#34;label&#34;</span><span class="p">,</span> <span class="s2">&#34;JsPsychMarker&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ch</span><span class="o">.</span><span class="n">append_child_value</span><span class="p">(</span><span class="s2">&#34;unit&#34;</span><span class="p">,</span> <span class="s2">&#34;string&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ch</span><span class="o">.</span><span class="n">append_child_value</span><span class="p">(</span><span class="s2">&#34;type&#34;</span><span class="p">,</span> <span class="s2">&#34;Marker&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">outlet</span> <span class="o">=</span> <span class="n">StreamOutlet</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># HTTP Request Handler</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MarkerHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">parsed</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&#34;/sync&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Return current LSL clock to JS</span>
</span></span><span class="line"><span class="cl">            <span class="n">ts</span> <span class="o">=</span> <span class="n">local_clock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&#34;/marker&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;1&#34;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">ts_js</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;ts&#34;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">ts_js</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">ts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ts_js</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">ts</span> <span class="o">=</span> <span class="n">local_clock</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">outlet</span><span class="o">.</span><span class="n">push_sample</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">ts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;â†’ Marker </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">ts</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;OK&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run_server</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">MarkerHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[LSL Bridge] Serving on http://</span><span class="si">{</span><span class="n">SERVER_HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">SERVER_PORT</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[LSL Bridge] Stream &#39;</span><span class="si">{</span><span class="n">LSL_STREAM_NAME</span><span class="si">}</span><span class="s2">&#39; ready for LabRecorder.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---------------------------------------------------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_server</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span></code></pre></div></details>
<h3 id="configuration-of-the-python-script">Configuration of the Python Script</h3>
<ol>
<li>
<p>Set-up</p>
<ul>
<li>
<p><strong>Imports</strong>: Load in standard python libraries for creating a web server (<code>http.server</code>, <code>urllib</code>) and the <code>mne_lsl</code> library to handle the data streaming.</p>
</li>
<li>
<p><strong>Configure Variables</strong>: Name the event trigger stream so you can find it in LabRecorder, e.g. <code>LSL_STREAM_NAME = &quot;jsPsychMarkers&quot;</code>.</p>
</li>
<li>
<p>Add <code>SERVER_HOST = &quot;0.0.0.0&quot;</code> into the script to tell the server to listen to all available network interfaces, allowing the participant&rsquo;s computer to communicate with the researcher&rsquo;s.</p>
</li>
<li>
<p>Specify the port for the html script to go to e.g. <code>SERVER_PORT = 5000</code>. You will add this port into the html script that holds the online experiment, in order to send the experiment to this python script.</p>
</li>
</ul>
</li>
<li>
<p>Create the LSL outlet for event triggers</p>
<ul>
<li>
<p>Define the metadata for the stream: <code>info = StreamInfo( name=LSL_STREAM_NAME...</code></p>
</li>
<li>
<p>Create the outlet object that will push data out to the network: <code>outlet = StreamOutlet(info)</code>.</p>
</li>
</ul>
</li>
<li>
<p>Create the request handler to define what happens when the participant&rsquo;s browser contacts the server.</p>
<ul>
<li>
<p>The sync route:</p>
<ul>
<li>
<p><code>if path == &quot;/sync&quot;:</code>: Checks if the browser is asking to synchronize clocks.</p>
</li>
<li>
<p><code>ts = local_clock()</code>: Grabs the current high-precision time from the LSL clock on the Recording Machine.</p>
</li>
<li>
<p><code>self.wfile.write(...)</code>: Sends this timestamp back to the browser. The browser needs this to calculate the time difference (offset) between the two computers.</p>
</li>
</ul>
</li>
<li>
<p>The marker route:</p>
<ul>
<li><code>elif path == &quot;/marker&quot;</code>: Checks if the browser is trying to send an event marker.</li>
<li>It extracts <code>value</code> (the marker name, e.g., &ldquo;1&rdquo;) and <code>ts</code> (the timestamp calculated by the browser) from the URL parameters.</li>
<li><code>outlet.push_sample([value], ts)</code>: This is the most important line. It injects the marker into the LSL stream <em>using the timestamp provided by the browser</em>. This ensures that even if there is network lag, the timestamp recorded in the EEG data remains accurate to when the event actually happened on the participant&rsquo;s screen.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Run the Server</p>
<ul>
<li><code>run_server()</code>: Starts the HTTP server and prints a confirmation message that it is ready for LabRecorder.</li>
<li><code>threading.Thread(...)</code>: Runs the server in a separate thread so it doesn&rsquo;t block the main Python process.</li>
</ul>
</li>
</ol>
<h3 id="configuration-of-the-jspsych-html-script">Configuration of the JsPsych HTML script</h3>
<details>
<summary>See an example of a full script</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Black/White Muse Synchronisation Test<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://unpkg.com/jspsych\@7.3.4&#34;</span><span class="err">\</span><span class="p">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="err">/script\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://unpkg.com/\@jspsych/plugin-html-keyboard-response\@1.1.3&#34;</span><span class="err">\</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="err">/script\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://unpkg.com/\@jspsych/plugin-image-keyboard-response\@1.1.3&#34;</span><span class="err">\</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="err">/script\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://unpkg.com/\@jspsych/plugin-preload\@1.1.3&#34;</span><span class="err">\</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="err">/script\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://unpkg.com/\@jspsych/plugin-fullscreen\@2.1.0&#34;</span><span class="err">\</span><span class="o">&gt;</span><span class="err">\</span><span class="o">&lt;</span><span class="err">/script\&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">link</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&#34;https://unpkg.com/jspsych@7.3.4/css/jspsych.css&#34;</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// -----------------------
</span></span></span><span class="line"><span class="cl"><span class="c1">// LSL bridge (promise-based)
</span></span></span><span class="line"><span class="cl"><span class="c1">// -----------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">lslBaseTime</span> <span class="o">=</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">syncLSL</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kr">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">offsets</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">startPerf</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="kd">let</span> <span class="nx">resp</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;http://139.184.128.202:5000/sync&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">cache</span><span class="o">:</span> <span class="s2">&#34;no-store&#34;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">                <span class="kd">let</span> <span class="nx">text</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">lslTime</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">endPerf</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="kd">var</span> <span class="nx">perfMid</span> <span class="o">=</span> <span class="p">(</span><span class="nx">startPerf</span> <span class="o">+</span> <span class="nx">endPerf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">                <span class="nx">offsets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">lslTime</span> <span class="o">-</span> <span class="nx">perfMid</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="kr">await</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="c1">// Short delay between syncs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">lslBaseTime</span> <span class="o">=</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">length</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;LSL sync done (averaged):&#34;</span><span class="p">,</span> <span class="nx">lslBaseTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">resolve</span><span class="p">(</span><span class="nx">lslBaseTime</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;LSL sync exception:&#34;</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">reject</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">sendMarker</span><span class="p">(</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// If not synced, still send marker (server will timestamp with local_clock())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">lslBaseTime</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;LSL not synced yet - sending without JS timestamp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;http://139.184.128.202:5000/marker?value=&#34;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;sent marker (no-ts)&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Marker send error:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">ts</span> <span class="o">=</span> <span class="nx">lslBaseTime</span> <span class="o">+</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;http://139.184.128.202:5000/marker?value=&#34;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;&amp;ts=&#34;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">ts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;sent marker&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="s2">&#34;ts&#34;</span><span class="p">,</span> <span class="nx">ts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Marker send error:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* --------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">   Experiment Definition
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------------------- */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">startExperiment</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">jsPsych</span> <span class="o">=</span> <span class="nx">initJsPsych</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">override_safe_mode</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">timeline</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* preload */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">timeline</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">jsPsychPreload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">images</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;white.png&#34;</span><span class="p">,</span> <span class="s2">&#34;black.png&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* stimuli */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">test_stimuli</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="nx">stimulus</span><span class="o">:</span> <span class="s2">&#34;white.png&#34;</span><span class="p">,</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">750</span><span class="p">,</span> <span class="nx">marker</span><span class="o">:</span> <span class="mi">0</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="nx">stimulus</span><span class="o">:</span> <span class="s2">&#34;black.png&#34;</span><span class="p">,</span> <span class="nx">duration</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span> <span class="nx">marker</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* trial */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">jsPsychImageKeyboardResponse</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">stimulus</span><span class="o">:</span> <span class="nx">jsPsych</span><span class="p">.</span><span class="nx">timelineVariable</span><span class="p">(</span><span class="s2">&#34;stimulus&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">trial_duration</span><span class="o">:</span> <span class="nx">jsPsych</span><span class="p">.</span><span class="nx">timelineVariable</span><span class="p">(</span><span class="s2">&#34;duration&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">choices</span><span class="o">:</span> <span class="s2">&#34;NO_KEYS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">marker</span><span class="o">:</span> <span class="nx">jsPsych</span><span class="p">.</span><span class="nx">timelineVariable</span><span class="p">(</span><span class="s2">&#34;marker&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">on_start</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">trial</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">sendMarker</span><span class="p">(</span><span class="nx">trial</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">marker</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">loop_node</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">timeline</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">timeline</span><span class="o">:</span> <span class="p">[</span><span class="nx">test</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">timeline_variables</span><span class="o">:</span> <span class="nx">test_stimuli</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">randomize_order</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="p">}],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loop_function</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="nx">jsPsych</span><span class="p">.</span><span class="nx">getTotalTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2100000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">timeline</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">loop_node</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">jsPsych</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">timeline</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// -----------------------
</span></span></span><span class="line"><span class="cl"><span class="c1">// Run: first sync then start experiment
</span></span></span><span class="line"><span class="cl"><span class="c1">// -----------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">syncLSL</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">startExperiment</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Proceeding without LSL sync (sync failed):&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">startExperiment</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div></details>
<p>The code sending triggers from the browser to the LSL bridge script is written in javascript. It is &lsquo;promise-based&rsquo;, meaning it is coded to wait until it receives a signal from the participant&rsquo;s computer. This code is designed to track the exact time it is on the participant&rsquo;s computer and send markers precisely aligned to that time.</p>
<ol>
<li>
<p>Synchronisation</p>
<ul>
<li>
<p><code>var lslBaseTime = null</code>: A variable to store the calculated time difference between the two computers.</p>
</li>
<li>
<p>The function <code>syncLSL() {...}</code> can be looped three times to get an average reading.</p>
</li>
<li>
<p>Get the time of the marker: <code>fetch(&quot;http://.../sync&quot;)</code></p>
</li>
<li>
<p>Record <code>startPerf</code> (when the request left) and <code>endPerf</code> (when the answer came back).</p>
</li>
<li>
<p>You can assume the server received the message exactly halfway between start and end (<code>perfMid</code>).</p>
</li>
<li>
<p>Calculate the difference between the browser&rsquo;s clock and the LSL clock: <code>offsets.push(lslTime - perfMid / 1000)</code>.</p>
</li>
<li>
<p>Finally, average these offsets into <code>lslBaseTime</code>. Now the browser knows how to convert its own time to LSL time.</p>
</li>
</ul>
</li>
<li>
<p>Sending markers</p>
<ul>
<li>
<p>Safety check in case sync fails: <code>if (lslBaseTime === null)</code> can be coded to send markers based on the timing from the participant&rsquo;s computer without synchronisation, which is less accurate but better than nothing.</p>
</li>
<li>
<p>Code the mathematical logic to account for the offset in time for the recording computer to receive the marker, so the generated timestamp aligns with the recording computer&rsquo;s timestamp: <code>var ts = lslBaseTime + performance.now() / 1000</code>.</p>
</li>
<li>
<p>Send the marker name and this calculated timestamp to the python bridge: <code>fetch(url)</code>.</p>
</li>
</ul>
</li>
</ol>
<h3 id="usage">Usage</h3>
<p>On the researcher&rsquo;s machine:</p>
<ol>
<li>Turn off the firewall in security settings for the researcher&rsquo;s machine.</li>
<li>Open the lsl bridge script and go onto the terminal (we use VS code). Type <code>ipconfig</code> to retrieve the ipv4 address.</li>
<li>In the terminal, type <code>pip install mne-lsl</code>.</li>
<li>Select all text in the bridge script and run it (ctrl+a, shift+enter)</li>
</ol>
<p>On the participant&rsquo;s machine:</p>
<ol>
<li>Open the html script. You will need to ensure the terminal working directory points towards your experiment folder- the best way to do this is to open your repository folder on VS code.</li>
<li>Copy the ipv4 address from the researcher&rsquo;s machine into the html script- there should be three instances before the <code>:5000</code> port address.</li>
<li>In a new terminal, run <code>python -m http.server 8000</code></li>
<li>You are now ready to run the experiment. Go onto your browser and enter the link &lsquo;<a href="http://localhost:8000/index.html" target="_blank" rel="noopener">http://localhost:8000/index.html</a>&rsquo;, adjusting for the name of your html script. Your experiment should now run on the participant&rsquo;s machine. The researcher can view markers received in their python terminal.</li>
</ol>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Special shoutout to our placement student Oliver Collins for preparing these scripts!&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

    </div>

    




<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/lsl/">LSL</a>
  
  <a class="badge badge-light" href="/tag/data-collection/">Data Collection</a>
  
  <a class="badge badge-light" href="/tag/jspsych/">JsPsych</a>
  
  <a class="badge badge-light" href="/tag/reality-bending-lab/">Reality Bending Lab</a>
  
  <a class="badge badge-light" href="/tag/rebel/">ReBeL</a>
  
  <a class="badge badge-light" href="/tag/university-of-sussex/">University of Sussex</a>
  
  <a class="badge badge-light" href="/tag/psychology/">Psychology</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://x.com/intent/tweet?url=https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F&amp;text=How&#43;to&#43;send&#43;event&#43;triggers&#43;to&#43;Lab&#43;Streaming&#43;Layer&#43;from&#43;JsPsych" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F&amp;t=How&#43;to&#43;send&#43;event&#43;triggers&#43;to&#43;Lab&#43;Streaming&#43;Layer&#43;from&#43;JsPsych" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=How%20to%20send%20event%20triggers%20to%20Lab%20Streaming%20Layer%20from%20JsPsych&amp;body=https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F&amp;title=How&#43;to&#43;send&#43;event&#43;triggers&#43;to&#43;Lab&#43;Streaming&#43;Layer&#43;from&#43;JsPsych" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=How&#43;to&#43;send&#43;event&#43;triggers&#43;to&#43;Lab&#43;Streaming&#43;Layer&#43;from&#43;JsPsych%20https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Frealitybending.github.io%2Fpost%2F2026-01-09-eventtriggers%2F&amp;title=How&#43;to&#43;send&#43;event&#43;triggers&#43;to&#43;Lab&#43;Streaming&#43;Layer&#43;from&#43;JsPsych" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    



  
  
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="/authors/roisin-sharma/"><img class="avatar mr-3 avatar-circle" src="/authors/roisin-sharma/avatar_hu_44c2aecd16997fca.jpg" alt="RÃ³isÃ­n Sharma"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/roisin-sharma/">RÃ³isÃ­n Sharma</a></h5>
      <h6 class="card-subtitle">Placement Student<sub><sup><br>University of Sussex</sup></sub></h6>
      <p class="card-text">Placement Student and Research Assistant at the Reality Bending Lab</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/RoisinSharma" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:rs843@sussex.ac.uk" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Roisin-Sharma" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  
















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  <p class="powered-by copyright-license-text">
    Â© 2026 Dominique Makowski
  </p>
  





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> â€” the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.42e34bbc1f9961306d4a9cf482572ccf.js"></script>




  

  
  

  






  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>








  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.b95a7e109243f29d04930ae8cb49a756.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.69fc52a6dc16aaf1a452cfbb36466dac.js"></script>



  <script src="/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js" type="module"></script>




  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js" type="module"></script>


















</body>
</html>
